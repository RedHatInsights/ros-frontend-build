"use strict";(self.webpackChunkros_frontend=self.webpackChunkros_frontend||[]).push([[821],{18771:(e,t,n)=>{n.r(t),n.d(t,{default:()=>de});var r=n(319),i=n.n(r),o=n(59713),s=n.n(o),a=n(87757),c=n.n(a),u=n(48926),l=n.n(u),p=n(34575),f=n.n(p),d=n(93913),m=n.n(d),y=n(81506),h=n.n(y),g=n(2205),v=n.n(g),b=n(78585),E=n.n(b),O=n(29754),w=n.n(O),k=n(1427),_=n.n(k),P=n(45697),x=n.n(P),S=n(16530),R=n(48716),z=n(39173),D=n(86350),j=n(2095),T=n(85962),C=n(86748),I=n(37703),N=n(33739),F=n(30319),L=n(18546),Z=n(76004),B=n(24814),A=n(67154),V=n.n(A),H=n(47945),U=function(e){var t=e.utilizedValue,n=e.measureLocation,r=e.eleId;return _().createElement(_().Fragment,null,_().createElement(H.Ex,V()({value:t,className:"progress-score-bar blue-300",measureLocation:n},r?{id:r}:null)))};U.propTypes={measureLocation:x().string,valueScore:x().number,utilizedValue:x().number,eleId:x().string};var W=n(84564),G=n(19694),Q=n(35451),q=n(2293),M=n(5381),X=n(82727),Y=n(18802),$=function(e){var t,n=e.stateValue,r=(t=n,{Oversized:{text:"This system is not fully consuming available resources and may be oversized.",icon:_().createElement(q.ZP,{color:"#f09800",size:"sm"})},Undersized:{text:"This system is depleting available resources and may be undersized.",icon:_().createElement(M.ZP,{color:"red",size:"sm"})},Idling:{text:"This system displays higher idling cycles than is expected.",icon:_().createElement(X.ZP,{size:"sm"})},"Storage rightsizing":{text:"This system is experiencing a storage Input/Output bottleneck.",icon:_().createElement(G.ZP,{color:"#f09800",size:"sm"})},Optimized:{text:"This system is running efficiently.",icon:_().createElement(Q.ZP,{color:"green",size:"sm"})},Crashloop:{text:"This system is experiencing a crash loop.",icon:_().createElement(W.ZP,{color:"red",size:"sm"})},"Waiting for data":{text:"This system is configured, please allow 24 hours for your upload to complete.",icon:_().createElement(Y.ZP,{color:"#2B9AF3",size:"sm"})}}[t]||{}),i=r.text,o=r.icon;return _().createElement("span",null,_().createElement("span",null,i?_().createElement(Z.Tooltip,{content:_().createElement("div",null,i)},_().createElement("span",null,o," ",n)):n))};$.propTypes={stateValue:x().string};var J=n(58061);function K(e,t){var n=Object.keys(e);if(Object.getOwnPropertySymbols){var r=Object.getOwnPropertySymbols(e);t&&(r=r.filter((function(t){return Object.getOwnPropertyDescriptor(e,t).enumerable}))),n.push.apply(n,r)}return n}function ee(e){for(var t=1;t<arguments.length;t++){var n=null!=arguments[t]?arguments[t]:{};t%2?K(Object(n),!0).forEach((function(t){s()(e,t,n[t])})):Object.getOwnPropertyDescriptors?Object.defineProperties(e,Object.getOwnPropertyDescriptors(n)):K(Object(n)).forEach((function(t){Object.defineProperty(e,t,Object.getOwnPropertyDescriptor(n,t))}))}return e}var te=function(e,t,n){var r=n.inventory_id,i=n.isDeleted,o=n.state;return i?_().createElement(Z.Tooltip,{content:_().createElement("div",null,e," has been deleted from inventory")},_().createElement("span",{tabIndex:"0"},e)):o===J.QR?_().createElement("span",null,e):_().createElement(S.Link,{to:{pathname:"/".concat(r)},className:"pf-link system-link link-".concat(r)},e)},ne=function(e){return _().createElement($,{stateValue:e})},re=function(){return function(e,t,n){return n.state===J.QR?_().createElement("span",null,J.t0):_().createElement(U,{measureLocation:"outside",utilizedValue:e})}},ie=function(e,t,n){var r=n.inventory_id,i=n.isDeleted,o=n.state;return i?_().createElement("span",null,o===J.QR?J.t0:e):o===J.QR?_().createElement("span",null,J.t0):_().createElement(S.Link,{to:{pathname:"/".concat(r)},className:"pf-link link-".concat(r)},e)},oe=function(e,t){return ee(ee({},e),{},{rows:e.rows.map((function(e){return ee(ee({},e),{},{isOpen:e.id===t.payload.id?t.payload.isOpen:e.isOpen})}))})},se=n(53704),ae=n(3955),ce=n(99621),ue=n(27839);function le(e,t){var n=Object.keys(e);if(Object.getOwnPropertySymbols){var r=Object.getOwnPropertySymbols(e);t&&(r=r.filter((function(t){return Object.getOwnPropertyDescriptor(e,t).enumerable}))),n.push.apply(n,r)}return n}function pe(e){for(var t=1;t<arguments.length;t++){var n=null!=arguments[t]?arguments[t]:{};t%2?le(Object(n),!0).forEach((function(t){s()(e,t,n[t])})):Object.getOwnPropertyDescriptors?Object.defineProperties(e,Object.getOwnPropertyDescriptors(n)):le(Object(n)).forEach((function(t){Object.defineProperty(e,t,Object.getOwnPropertyDescriptor(n,t))}))}return e}var fe=function(e){v()(d,e);var t,n,r,o,a,u,p=(a=d,u=function(){if("undefined"==typeof Reflect||!Reflect.construct)return!1;if(Reflect.construct.sham)return!1;if("function"==typeof Proxy)return!0;try{return Date.prototype.toString.call(Reflect.construct(Date,[],(function(){}))),!0}catch(e){return!1}}(),function(){var e,t=w()(a);if(u){var n=w()(this).constructor;e=Reflect.construct(t,arguments,n)}else e=t.apply(this,arguments);return E()(this,e)});function d(e){var t;return f()(this,d),(t=p.call(this,e)).state={perPage:10,orderBy:"display_name",orderDirection:C.SortByDirection.asc,columns:[{key:"display_name",title:"Name",renderFunc:te},{key:"performance_utilization.cpu",title:"CPU utilization",renderFunc:re()},{key:"performance_utilization.memory",title:"Memory utilization",renderFunc:re()},{key:"performance_utilization.io",title:"I/O utilization",renderFunc:re()},{key:"number_of_suggestions",title:"Suggestions",renderFunc:ie},{key:"state",title:"State",renderFunc:ne}]},t.sortingHeader={display_name:"display_name","performance_utilization.cpu":"cpu","performance_utilization.memory":"memory","performance_utilization.io":"io",number_of_suggestions:"number_of_suggestions",state:"state"},t.chunkSize=50,t.inventory=_().createRef(),t.fetchSystems=t.fetchSystems.bind(h()(t)),t}return m()(d,[{key:"componentDidMount",value:(o=l()(c().mark((function e(){var t,n;return c().wrap((function(e){for(;;)switch(e.prev=e.next){case 0:return document.title="Resource Optimization - Red Hat Insights",null===(t=insights.chrome)||void 0===t||null===(n=t.hideGlobalFilter)||void 0===n||n.call(t,!0),insights.chrome.appAction("ros-systems"),e.next=5,this.props.isROSConfigured();case 5:case"end":return e.stop()}}),e,this)}))),function(){return o.apply(this,arguments)})},{key:"fetchSystems",value:(r=l()(c().mark((function e(t){var n,r,i;return c().wrap((function(e){for(;;)switch(e.prev=e.next){case 0:return e.next=2,window.insights.chrome.auth.getUser();case 2:return r=pe({limit:t.perPage,offset:(t.page-1)*t.perPage,order_by:t.orderBy||this.state.orderBy,order_how:t.orderHow||this.state.orderDirection},(null==t||null===(n=t.filters)||void 0===n?void 0:n.hostnameOrId)&&{display_name:t.filters.hostnameOrId}),(i=new URL(J.RC+J.M4,window.location.origin)).search=new URLSearchParams(r).toString(),e.abrupt("return",fetch(i).then((function(e){if(!e.ok)throw Error(e.statusText);return e})).then((function(e){return e.json()})));case 6:case"end":return e.stop()}}),e,this)}))),function(e){return r.apply(this,arguments)})},{key:"chunkIdsArray",value:function(e){for(var t=[];e.length;)t.push(e.splice(0,this.chunkSize));return t}},{key:"fetchInventoryDetails",value:(n=l()(c().mark((function e(t,n){var r,o,s,a;return c().wrap((function(e){for(;;)switch(e.prev=e.next){case 0:if(r=[],!(n.per_page>50&&t.length>50)){e.next=8;break}return e.next=4,this.multipleGetEntitiesRequests(t,n);case 4:e.sent.map((function(e){var t;(t=r).push.apply(t,i()(e))})),e.next=12;break;case 8:return e.next=10,null===(o=(s=this.state).getEntities)||void 0===o?void 0:o.call(s,t,n,!1);case 10:a=e.sent,r=a.results;case 12:return e.abrupt("return",r);case 13:case"end":return e.stop()}}),e,this)}))),function(e,t){return n.apply(this,arguments)})},{key:"multipleGetEntitiesRequests",value:(t=l()(c().mark((function e(t,n){var r,i=this;return c().wrap((function(e){for(;;)switch(e.prev=e.next){case 0:return r=this.chunkIdsArray(t),e.abrupt("return",Promise.all(r.map(function(){var e=l()(c().mark((function e(t){var r,o,s,a;return c().wrap((function(e){for(;;)switch(e.prev=e.next){case 0:return e.next=2,null===(r=(o=i.state).getEntities)||void 0===r?void 0:r.call(o,t,n,!1);case 2:return s=e.sent,a=s.results,e.abrupt("return",a);case 5:case"end":return e.stop()}}),e)})));return function(t){return e.apply(this,arguments)}}())).then((function(e){return e})));case 2:case"end":return e.stop()}}),e,this)}))),function(e,n){return t.apply(this,arguments)})},{key:"renderConfigStepsOrTable",value:function(){var e=this;return this.props.showConfigSteps?_().createElement(ae.v,null):_().createElement(j.Zb,{className:"pf-t-light  pf-m-opaque-100"},_().createElement(T.e,null,_().createElement(N.Z,{disableDefaultColumns:!0,ref:this.inventory,hasCheckbox:!1,tableProps:{canSelectAll:!1,className:"ros-systems-table"},variant:"compact",hideFilters:{stale:!0,registeredWith:!0},getEntities:function(){var t=l()(c().mark((function t(n,r){var i,o,s;return c().wrap((function(t){for(;;)switch(t.prev=t.next){case 0:return e.setState((function(){return{orderBy:r.orderBy,orderDirection:r.orderDirection}})),t.next=3,e.fetchSystems({page:r.page,perPage:r.per_page,orderBy:e.sortingHeader[r.orderBy],orderHow:r.orderDirection,filters:r.filters});case 3:return i=t.sent,o=(i.data||[]).map((function(e){return e.inventory_id})),t.next=7,e.fetchInventoryDetails(o,pe(pe({},r),{},{page:1,hasItems:!0}));case 7:return s=t.sent,t.abrupt("return",{results:i.data.map((function(e){var t=s.find((function(t){return t.id===e.inventory_id}));return pe(pe(pe({},t),t?{isDeleted:!1}:{id:e.inventory_id,isDeleted:!0}),e)})),total:i.meta.count,page:r.page,per_page:r.per_page});case 9:case"end":return t.stop()}}),t)})));return function(e,n){return t.apply(this,arguments)}}(),onLoad:function(t){var n,r,i,o,a=t.mergeWithEntities,c=t.INVENTORY_ACTION_TYPES,u=t.api;e.setState({getEntities:null==u?void 0:u.getEntities}),(0,F.z2)(pe({},a((n=c,r=e.state.columns,o=n.LOAD_ENTITIES_FULFILLED,(0,L.Gg)((i={},s()(i,o,(function(e){return function(e,t){return ee(ee({},t),{},{columns:e,rows:t.rows.map((function(e){return ee(ee({},e),{},{children:(t=e,n=t.id,r=t.cloud_provider,i=t.instance_type,o=t.idling_time,s=t.io_wait,_().createElement(B.v,{id:n,cloudProvider:r,instanceType:i,idlingTime:o,ioWait:s}))});var t,n,r,i,o,s})),loaded:!0})}(r,e)})),s()(i,"EXPAND_ROW",oe),i)))))),e.props.setSort(e.state.orderBy,e.state.orderDirection,"CHANGE_SORT")},expandable:"true",onExpandClick:function(t,n,r,i){var o=i.id;return e.props.expandRow(o,r,"EXPAND_ROW")}})))}},{key:"render",value:function(){var e=this;return _().createElement(_().Fragment,null,_().createElement(R.Z,null,_().createElement(z.Z,{title:"Resource Optimization"})),_().createElement(D.Z,null,_().createElement(ce.B.Consumer,null,(function(t){return!1===t.permissions.systemsRead?_().createElement(ue.Z,{serviceName:"Resource Optimization"}):e.renderConfigStepsOrTable()}))))}}]),d}(_().Component);fe.propTypes={expandRow:x().func,setSort:x().func,isROSConfigured:x().func,showConfigSteps:x().bool};const de=(0,S.withRouter)((0,I.$j)((function(e,t){var n;return pe({showConfigSteps:null===(n=e.isConfiguredReducer)||void 0===n?void 0:n.showConfigSteps},t)}),(function(e){return{expandRow:function(t,n,r){return e({type:r,payload:{id:t,isOpen:n}})},setSort:function(t,n,r){return e({type:r,payload:{key:t,direction:n}})},isROSConfigured:function(){return e((0,se.Pn)())}}}))(fe))}}]);