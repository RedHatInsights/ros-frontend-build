"use strict";(self.webpackChunkros_frontend=self.webpackChunkros_frontend||[]).push([[821],{18771:(e,t,r)=>{r.r(t),r.d(t,{default:()=>pe});var n=r(319),o=r.n(n),i=r(59713),a=r.n(i),s=r(87757),c=r.n(s),u=r(48926),l=r.n(u),p=r(34575),m=r.n(p),d=r(93913),f=r.n(d),y=r(81506),h=r.n(y),v=r(2205),g=r.n(v),b=r(78585),_=r.n(b),E=r(29754),O=r.n(E),w=r(1427),k=r.n(w),x=r(45697),P=r.n(x),D=r(16530),S=r(48716),j=r(39173),R=r(86350),T=r(2095),z=r(85962),I=r(86748),N=r(80962),L=r(33739),Z=r(30319),C=r(18546),F=r(76004),B=r(24814),A=r(67154),U=r.n(A),W=r(47945),G=function(e){var t,r=e.valueScore,n=e.measureLocation,o=e.eleId,i="".concat(r,"/5");return k().createElement(k().Fragment,null,k().createElement(W.Ex,U()({value:r,min:0,max:5,label:i,valueText:i,className:"progress-score-bar ".concat((t=r,{5:"green-400",4:"green-100",3:"gold-400",2:"orange-300"}[t]||"danger-200")),measureLocation:n},o?{id:o}:null)))};G.propTypes={measureLocation:P().string,valueScore:P().number,eleId:P().string};var H=r(84564),V=r(19694),q=r(35451),M=r(2293),X=r(5381),Y=r(82727),J=r(18802),K=function(e){var t,r=e.stateValue,n=(t=r,{Oversized:{text:"This system is not fully consuming available resources and may be oversized.",icon:k().createElement(M.ZP,{color:"#f09800",size:"sm"})},Undersized:{text:"This system is depleting available resources and may be undersized.",icon:k().createElement(X.ZP,{color:"red",size:"sm"})},Idling:{text:"This system displays higher idling cycles than is expected.",icon:k().createElement(Y.ZP,{size:"sm"})},"Storage rightsizing":{text:"This system is experiencing a storage Input/Output bottleneck.",icon:k().createElement(V.ZP,{color:"#f09800",size:"sm"})},Optimized:{text:"This system is running efficiently.",icon:k().createElement(q.ZP,{color:"green",size:"sm"})},Crashloop:{text:"This system is experiencing a crash loop.",icon:k().createElement(H.ZP,{color:"red",size:"sm"})},"Waiting for data":{text:"This system is configured, please allow 24 hours for your upload to complete.",icon:k().createElement(J.ZP,{color:"blue",size:"sm"})}}[t]||{}),o=n.text,i=n.icon;return k().createElement("span",null,k().createElement("span",null,o?k().createElement(F.Tooltip,{content:k().createElement("div",null,o)},k().createElement("span",null,i," ",r)):r))};function Q(e,t){var r=Object.keys(e);if(Object.getOwnPropertySymbols){var n=Object.getOwnPropertySymbols(e);t&&(n=n.filter((function(t){return Object.getOwnPropertyDescriptor(e,t).enumerable}))),r.push.apply(r,n)}return r}function $(e){for(var t=1;t<arguments.length;t++){var r=null!=arguments[t]?arguments[t]:{};t%2?Q(Object(r),!0).forEach((function(t){a()(e,t,r[t])})):Object.getOwnPropertyDescriptors?Object.defineProperties(e,Object.getOwnPropertyDescriptors(r)):Q(Object(r)).forEach((function(t){Object.defineProperty(e,t,Object.getOwnPropertyDescriptor(r,t))}))}return e}K.propTypes={stateValue:P().string};var ee=function(e,t,r){var n=r.inventory_id;return r.isDeleted?k().createElement(F.Tooltip,{content:k().createElement("div",null,e," has been deleted from inventory")},k().createElement("span",{tabIndex:"0"},e)):k().createElement(D.Link,{to:{pathname:"/".concat(n)},className:"pf-link system-link link-".concat(n)},e)},te=function(e){return k().createElement(K,{stateValue:e})},re=function(e){return k().createElement(G,{measureLocation:"outside",valueScore:e})},ne=function(e,t,r){var n=r.inventory_id;return r.isDeleted?k().createElement("span",{className:"recommendations"},e):k().createElement(D.Link,{to:{pathname:"/".concat(n)},className:"pf-link recommendations ".concat(0===e?"green-400":""," link-").concat(n)},e)},oe=function(e,t){return $($({},e),{},{rows:e.rows.map((function(e){return $($({},e),{},{isOpen:e.id===t.payload.id?t.payload.isOpen:e.isOpen})}))})},ie=r(58061),ae=r(99621),se=r(27839);function ce(e,t){var r=Object.keys(e);if(Object.getOwnPropertySymbols){var n=Object.getOwnPropertySymbols(e);t&&(n=n.filter((function(t){return Object.getOwnPropertyDescriptor(e,t).enumerable}))),r.push.apply(r,n)}return r}function ue(e){for(var t=1;t<arguments.length;t++){var r=null!=arguments[t]?arguments[t]:{};t%2?ce(Object(r),!0).forEach((function(t){a()(e,t,r[t])})):Object.getOwnPropertyDescriptors?Object.defineProperties(e,Object.getOwnPropertyDescriptors(r)):ce(Object(r)).forEach((function(t){Object.defineProperty(e,t,Object.getOwnPropertyDescriptor(r,t))}))}return e}var le=function(e){g()(d,e);var t,r,n,i,s,u,p=(s=d,u=function(){if("undefined"==typeof Reflect||!Reflect.construct)return!1;if(Reflect.construct.sham)return!1;if("function"==typeof Proxy)return!0;try{return Date.prototype.toString.call(Reflect.construct(Date,[],(function(){}))),!0}catch(e){return!1}}(),function(){var e,t=O()(s);if(u){var r=O()(this).constructor;e=Reflect.construct(t,arguments,r)}else e=t.apply(this,arguments);return _()(this,e)});function d(e){var t;return m()(this,d),(t=p.call(this,e)).state={perPage:10,orderBy:"display_name",orderDirection:I.SortByDirection.asc,columns:[{key:"display_name",title:"Name",renderFunc:ee},{key:"display_performance_score.cpu_score",title:"CPU score",renderFunc:re},{key:"display_performance_score.memory_score",title:"Memory score",renderFunc:re},{key:"display_performance_score.io_score",title:"I/O score",renderFunc:re},{key:"number_of_recommendations",title:"Recommendations",renderFunc:ne},{key:"state",title:"State",renderFunc:te}]},t.sortingHeader={display_name:"display_name","display_performance_score.cpu_score":"cpu_score","display_performance_score.memory_score":"memory_score","display_performance_score.io_score":"io_score",number_of_recommendations:"number_of_recommendations",state:"state"},t.chunkSize=50,t.inventory=k().createRef(),t.fetchSystems=t.fetchSystems.bind(h()(t)),t}return f()(d,[{key:"componentDidMount",value:(i=l()(c().mark((function e(){var t,r;return c().wrap((function(e){for(;;)switch(e.prev=e.next){case 0:null===(t=insights.chrome)||void 0===t||null===(r=t.hideGlobalFilter)||void 0===r||r.call(t,!0),insights.chrome.appAction("ros-systems");case 2:case"end":return e.stop()}}),e)}))),function(){return i.apply(this,arguments)})},{key:"fetchSystems",value:(n=l()(c().mark((function e(t){var r,n,o;return c().wrap((function(e){for(;;)switch(e.prev=e.next){case 0:return e.next=2,window.insights.chrome.auth.getUser();case 2:return n=ue({limit:t.perPage,offset:(t.page-1)*t.perPage,order_by:t.orderBy||this.state.orderBy,order_how:t.orderHow||this.state.orderDirection},(null==t||null===(r=t.filters)||void 0===r?void 0:r.hostnameOrId)&&{display_name:t.filters.hostnameOrId}),(o=new URL(ie.RC+ie.M4,window.location.origin)).search=new URLSearchParams(n).toString(),e.abrupt("return",fetch(o).then((function(e){if(!e.ok)throw Error(e.statusText);return e})).then((function(e){return e.json()})));case 6:case"end":return e.stop()}}),e,this)}))),function(e){return n.apply(this,arguments)})},{key:"chunkIdsArray",value:function(e){for(var t=[];e.length;)t.push(e.splice(0,this.chunkSize));return t}},{key:"fetchInventoryDetails",value:(r=l()(c().mark((function e(t,r){var n,i,a,s;return c().wrap((function(e){for(;;)switch(e.prev=e.next){case 0:if(n=[],!(r.per_page>50&&t.length>50)){e.next=8;break}return e.next=4,this.multipleGetEntitiesRequests(t,r);case 4:e.sent.map((function(e){var t;(t=n).push.apply(t,o()(e))})),e.next=12;break;case 8:return e.next=10,null===(i=(a=this.state).getEntities)||void 0===i?void 0:i.call(a,t,r,!1);case 10:s=e.sent,n=s.results;case 12:return e.abrupt("return",n);case 13:case"end":return e.stop()}}),e,this)}))),function(e,t){return r.apply(this,arguments)})},{key:"multipleGetEntitiesRequests",value:(t=l()(c().mark((function e(t,r){var n,o=this;return c().wrap((function(e){for(;;)switch(e.prev=e.next){case 0:return n=this.chunkIdsArray(t),e.abrupt("return",Promise.all(n.map(function(){var e=l()(c().mark((function e(t){var n,i,a,s;return c().wrap((function(e){for(;;)switch(e.prev=e.next){case 0:return e.next=2,null===(n=(i=o.state).getEntities)||void 0===n?void 0:n.call(i,t,r,!1);case 2:return a=e.sent,s=a.results,e.abrupt("return",s);case 5:case"end":return e.stop()}}),e)})));return function(t){return e.apply(this,arguments)}}())).then((function(e){return e})));case 2:case"end":return e.stop()}}),e,this)}))),function(e,r){return t.apply(this,arguments)})},{key:"render",value:function(){var e=this;return k().createElement(k().Fragment,null,k().createElement(S.Z,null,k().createElement(j.Z,{title:"Resource Optimization"})),k().createElement(R.Z,null,k().createElement(ae.B.Consumer,null,(function(t){return!1===t.permissions.systemsRead?k().createElement(se.Z,{serviceName:"Resource Optimization"}):k().createElement(T.Zb,{className:"pf-t-light  pf-m-opaque-100"},k().createElement(z.e,null,k().createElement(L.Z,{disableDefaultColumns:!0,ref:e.inventory,hasCheckbox:!1,tableProps:{canSelectAll:!1,className:"ros-systems-table"},variant:"compact",hideFilters:{stale:!0,registeredWith:!0},getEntities:function(){var t=l()(c().mark((function t(r,n){var o,i,a;return c().wrap((function(t){for(;;)switch(t.prev=t.next){case 0:return e.setState((function(){return{orderBy:n.orderBy,orderDirection:n.orderDirection}})),t.next=3,e.fetchSystems({page:n.page,perPage:n.per_page,orderBy:e.sortingHeader[n.orderBy],orderHow:n.orderDirection,filters:n.filters});case 3:return o=t.sent,i=(o.data||[]).map((function(e){return e.inventory_id})),t.next=7,e.fetchInventoryDetails(i,ue(ue({},n),{},{page:1,hasItems:!0}));case 7:return a=t.sent,t.abrupt("return",{results:o.data.map((function(e){var t=a.find((function(t){return t.id===e.inventory_id}));return ue(ue(ue({},t),t?{isDeleted:!1}:{id:e.inventory_id,isDeleted:!0}),e)})),total:o.meta.count,page:n.page,per_page:n.per_page});case 9:case"end":return t.stop()}}),t)})));return function(e,r){return t.apply(this,arguments)}}(),onLoad:function(t){var r,n,o,i,s=t.mergeWithEntities,c=t.INVENTORY_ACTION_TYPES,u=t.api;e.setState({getEntities:null==u?void 0:u.getEntities}),(0,Z.z2)(ue({},s((r=c,n=e.state.columns,i=r.LOAD_ENTITIES_FULFILLED,(0,C.Gg)((o={},a()(o,i,(function(e){return function(e,t){return $($({},t),{},{columns:e,rows:t.rows.map((function(e){return $($({},e),{},{children:(t=e,r=t.id,n=t.cloud_provider,o=t.instance_type,i=t.idling_time,a=t.io_wait,k().createElement(B.v,{id:r,cloudProvider:n,instanceType:o,idlingTime:i,ioWait:a}))});var t,r,n,o,i,a})),loaded:!0})}(n,e)})),a()(o,"EXPAND_ROW",oe),o)))))),e.props.setSort(e.state.orderBy,e.state.orderDirection,"CHANGE_SORT")},expandable:"true",onExpandClick:function(t,r,n,o){var i=o.id;return e.props.expandRow(i,n,"EXPAND_ROW")}})))}))))}}]),d}(k().Component);le.propTypes={expandRow:P().func,setSort:P().func};const pe=(0,D.withRouter)((0,N.connect)(null,(function(e){return{expandRow:function(t,r,n){return e({type:n,payload:{id:t,isOpen:r}})},setSort:function(t,r,n){return e({type:n,payload:{key:t,direction:r}})}}}))(le))}}]);